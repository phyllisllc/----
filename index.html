<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>å¹¸è¿ç¦åˆ©æŠ½ä¸åœ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FF4D4F',
            secondary: '#FF9500',
            background: '#FF6B6B',
            lightBg: '#FF8E8E',
            gold: '#FFD700',
            darkGold: '#FFB800',
          },
          fontFamily: {
            sans: ['Arial', 'PingFang SC', 'Microsoft YaHei', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }
      .prize-item {
        transition: all 0.3s ease;
      }
      .prize-item.active {
        transform: scale(1.05);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        border-color: #FFD700;
      }
      .prize-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }
      .gift-box {
        animation: float 3s ease-in-out infinite;
      }
      @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
      }
      .rotate-animation {
        animation: rotate 1s ease-in-out infinite;
      }
      @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      .shine {
        position: relative;
        overflow: hidden;
      }
      .shine::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          to right,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.3) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        transform: rotate(30deg);
        animation: shine 6s infinite;
      }
      @keyframes shine {
        0% { transform: rotate(30deg) translateX(-100%); }
        100% { transform: rotate(30deg) translateX(100%); }
      }
    }
  </style>
</head>
<body class="bg-gradient-to-b from-background to-lightBg min-h-screen text-white overflow-x-hidden">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="px-4 py-3 flex justify-between items-center relative z-10">
    <div class="text-sm opacity-80">9:41</div>
    <div class="flex items-center space-x-2">
      <i class="fa fa-signal"></i>
      <i class="fa fa-wifi"></i>
      <i class="fa fa-battery-three-quarters"></i>
    </div>
  </header>

  <!-- ä¸»æ ‡é¢˜ -->
  <div class="text-center px-4 mb-2">
    <h1 class="text-[clamp(1.5rem,5vw,2rem)] font-bold text-shadow">å¹¸è¿ç¦åˆ©æŠ½ä¸åœ</h1>
  </div>

  <!-- æ´»åŠ¨ä¿¡æ¯ -->
  <div class="flex justify-center items-center px-4 mb-4">
    <div class="bg-white/20 rounded-full px-6 py-2 backdrop-blur-sm">
      <span class="text-white text-sm">æ´»åŠ¨å¹¸è¿æŠ½å¥–</span>
    </div>
    <div id="my-prizes" class="ml-4 bg-white/20 rounded-full px-4 py-2 backdrop-blur-sm cursor-pointer hover:bg-white/30 transition-all">
      <span class="text-white text-sm">æˆ‘çš„å¥–å“</span>
    </div>
    <!-- ç®¡ç†å‘˜å…¥å£ - å·²å‚ä¸æŒ‰é’® -->
    <div id="admin-entry" class="ml-4 bg-white/20 rounded-full px-4 py-2 backdrop-blur-sm cursor-pointer hover:bg-white/30 transition-all">
      <span class="text-white text-sm">å·²å‚ä¸</span>
    </div>
  </div>

  <!-- ç¤¼å“ç›’å­åŠ¨ç”»åŒºåŸŸ -->
  <div class="relative w-full max-w-xs mx-auto mb-6">
    <div class="gift-box relative">
      <!-- ç¤¼å“ç›’å­ -->
      <div class="w-32 h-32 bg-primary rounded-lg mx-auto relative overflow-hidden">
        <div class="absolute w-full h-2 bg-secondary -top-1 left-0 rounded-t-full"></div>
        <div class="absolute w-2 h-full bg-secondary -left-1 top-0 rounded-l-full"></div>
        <div class="absolute w-full h-2 bg-secondary -bottom-1 left-0 rounded-b-full"></div>
        <div class="absolute w-2 h-full bg-secondary -right-1 top-0 rounded-r-full"></div>
        
        <!-- ä¸å¸¦ -->
        <div class="absolute w-4 h-full bg-secondary left-1/2 -ml-2 top-0"></div>
        <div class="absolute w-full h-4 bg-secondary top-1/2 -mt-2"></div>
        
        <!-- è´è¶ç»“ -->
        <div class="absolute top-0 left-1/2 -ml-6 w-12 h-6 bg-secondary rounded-full"></div>
        <div class="absolute top-0 left-1/2 -ml-2 w-4 h-4 bg-secondary rounded-full transform -translate-y-1/2"></div>
        
        <!-- ç¤¼ç‰©å†…å®¹ -->
        <div class="absolute inset-0 flex items-center justify-center flex-col">
          <i class="fa fa-gift text-gold text-2xl mb-1"></i>
          <i class="fa fa-coffee text-white text-lg rotate-animation"></i>
        </div>
      </div>
      
      <!-- å…‰ç¯æ•ˆæœ -->
      <div class="absolute w-full h-6 bg-darkGold/30 rounded-full left-0 top-full mt-2"></div>
      <div class="absolute w-4/5 h-6 bg-darkGold/20 rounded-full left-1/2 -ml-2/5 top-full mt-4"></div>
    </div>
  </div>

  <!-- æŠ½å¥–æ¬¡æ•°æç¤º -->
  <div class="text-center px-4 mb-6">
    <div class="inline-block bg-white/20 backdrop-blur-sm rounded-full px-6 py-2">
      <span class="text-white">æ‚¨ä»Šå¤©æœ‰ <i class="fa fa-gift text-gold"></i> 1æ¬¡æŠ½å¥–æœºä¼š</span>
    </div>
  </div>

  <!-- æŠ½å¥–åŒºåŸŸ -->
  <div class="px-4">
    <div class="bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20">
      <!-- å·²æŠ½å¥–æç¤º -->
      <div id="already-drawn" class="text-center mb-3 text-sm text-yellow-300 hidden">
        <i class="fa fa-info-circle mr-1"></i>æ‚¨ä»Šå¤©å·²ç»å‚ä¸è¿‡æŠ½å¥–äº†
      </div>
      
      <!-- å¥–å“ç½‘æ ¼ -->
      <div class="prize-grid">
        <!-- å¥–å“1: ç‰¹ç­‰å¥– -->
        <div id="prize-1" class="prize-item bg-gradient-to-br from-gold to-darkGold rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-white text-xs font-bold mb-1 text-center">å®‡æ ‘Go2 Air</div>
          <div class="text-white text-xs font-bold mb-1">æœºå™¨ç‹—</div>
          <div class="text-white"><i class="fa fa-paw text-lg"></i></div>
        </div>
        
        <!-- å¥–å“2: ä¸€ç­‰å¥– -->
        <div id="prize-2" class="prize-item bg-gradient-to-br from-gray-200 to-gray-400 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-gray-800 text-xs font-bold mb-1">å¾·é¾™å’–å•¡æœº</div>
          <div class="text-gray-800 text-xs font-bold mb-1">S3 Plus</div>
          <div class="text-gray-800"><i class="fa fa-coffee text-lg"></i></div>
        </div>
        
        <!-- å¥–å“3: äºŒç­‰å¥– -->
        <div id="prize-3" class="prize-item bg-white/90 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-secondary text-xs font-bold mb-1 text-center">ç¾çš„å•†ç”¨å¾®æ³¢ç‚‰</div>
          <div class="text-secondary"><i class="fa fa-fire text-lg"></i></div>
        </div>
        
        <!-- å¥–å“4: ä¸‰ç­‰å¥– -->
        <div id="prize-4" class="prize-item bg-white/90 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-primary text-sm font-bold mb-1 text-center">èŒ¶æ¯æ¶ˆæ¯’æŸœ</div>
          <div class="text-primary"><i class="fa fa-shield text-lg"></i></div>
        </div>
        
        <!-- æŠ½å¥–æŒ‰é’® -->
        <div id="draw-btn" class="bg-gradient-to-r from-primary to-secondary rounded-lg flex flex-col items-center justify-center aspect-square cursor-pointer active:scale-95 transition-all">
          <div class="text-white font-bold text-lg">å¼€å§‹æŠ½å¥–</div>
          <i class="fa fa-refresh text-white mt-1"></i>
        </div>
        
        <!-- å¥–å“5: å››ç­‰å¥– -->
        <div id="prize-5" class="prize-item bg-white/90 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-primary text-sm font-bold mb-1 text-center">3000-200å…ƒ</div>
          <div class="text-primary text-sm font-bold mb-1">ä¼˜æƒ åˆ¸</div>
          <div class="text-primary"><i class="fa fa-ticket text-lg"></i></div>
        </div>
        
        <!-- å¥–å“6: äº”ç­‰å¥– -->
        <div id="prize-6" class="prize-item bg-white/90 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-primary text-sm font-bold mb-1 text-center">1000-50å…ƒ</div>
          <div class="text-primary text-sm font-bold mb-1">ä¼˜æƒ åˆ¸</div>
          <div class="text-primary"><i class="fa fa-ticket text-lg"></i></div>
        </div>
        
        <!-- å¥–å“7: å…­ç­‰å¥– -->
        <div id="prize-7" class="prize-item bg-white/90 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-primary text-sm font-bold mb-1 text-center">300-20å…ƒ</div>
          <div class="text-primary text-sm font-bold mb-1">ä¼˜æƒ åˆ¸</div>
          <div class="text-primary"><i class="fa fa-ticket text-lg"></i></div>
        </div>
        
        <!-- å¥–å“8: è°¢è°¢å‚ä¸ -->
        <div id="prize-8" class="prize-item bg-white/90 rounded-lg p-3 flex flex-col items-center justify-center aspect-square">
          <div class="text-gray-400 text-sm font-bold mb-1">è°¢è°¢å‚ä¸</div>
          <div class="text-gray-400"><i class="fa fa-smile-o text-lg"></i></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ç”µè¯å·ç è¾“å…¥å¼¹çª— -->
  <div id="phone-modal" class="fixed inset-0 bg-black/50 z-50 items-center justify-center hidden">
    <!-- ç”µè¯å·ç è¾“å…¥å¼¹çª—å†…å®¹ -->
  </div>
  
  <!-- æˆ‘çš„å¥–å“å¼¹çª— -->
  <div id="prizes-modal" class="fixed inset-0 bg-black/50 z-50 items-center justify-center hidden">
    <div class="bg-white rounded-xl w-4/5 max-w-sm overflow-hidden transform transition-all duration-300 scale-100">
      <div class="bg-gradient-to-r from-primary to-secondary p-4 text-center">
        <h3 class="text-white text-xl font-bold">æˆ‘çš„å¥–å“</h3>
      </div>
      <div class="p-6 max-h-[60vh] overflow-y-auto">
        <div id="prizes-list" class="space-y-4">
          <!-- å¥–å“åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        <div id="no-prizes" class="text-center text-gray-500 py-8 hidden">
          <i class="fa fa-trophy text-gray-300 text-3xl mb-2"></i>
          <p>æš‚æ— ä¸­å¥–è®°å½•</p>
        </div>
      </div>
      <div class="px-6 pb-6">
        <button id="close-prizes" class="bg-gray-200 text-gray-700 py-3 px-8 rounded-full font-bold w-full hover:bg-gray-300 transition-all">
          å…³é—­
        </button>
      </div>
    </div>
  </div>
      
      

        
        // æ¸…ç©ºç°æœ‰åˆ—è¡¨
        prizesList.innerHTML = '';
        
        if (!currentPhone) {
          // å¦‚æœæ²¡æœ‰ç”µè¯å·ç ï¼Œæ˜¾ç¤ºæ— è®°å½•
          noPrizes.classList.remove('hidden');
          prizesList.classList.add('hidden');
        } else {
          // ä»localStorageè·å–æ‰€æœ‰ä¸­å¥–è®°å½•
          const allUserPrizes = JSON.parse(localStorage.getItem('userPrizes') || '[]');
          console.log('æ‰€æœ‰ä¸­å¥–è®°å½•:', allUserPrizes);
          
          // ç­›é€‰å½“å‰ç”¨æˆ·çš„ä¸­å¥–è®°å½•
          const userPrizes = allUserPrizes.filter(item => item.phone === currentPhone);
          
          if (userPrizes.length === 0) {
            // æ— ä¸­å¥–è®°å½•
            noPrizes.classList.remove('hidden');
            prizesList.classList.add('hidden');
          } else {
            // æœ‰ä¸­å¥–è®°å½•ï¼Œç”Ÿæˆåˆ—è¡¨
            noPrizes.classList.add('hidden');
            prizesList.classList.remove('hidden');
            
            // æŒ‰æ—¶é—´å€’åºæ’åº
            userPrizes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            userPrizes.forEach((prize) => {
              const prizeItem = document.createElement('div');
              prizeItem.className = 'bg-gradient-to-r from-primary/10 to-secondary/10 rounded-lg p-4 flex items-center';
              
              // å¥–å“å›¾æ ‡
              const iconDiv = document.createElement('div');
              iconDiv.className = 'bg-white rounded-full w-12 h-12 flex items-center justify-center mr-4 shadow-md';
              iconDiv.innerHTML = `<i class="fa ${prize.prizeIcon} text-primary text-xl"></i>`;
              
              // å¥–å“ä¿¡æ¯
              const infoDiv = document.createElement('div');
              infoDiv.className = 'flex-1';
              
              const nameSpan = document.createElement('div');
              nameSpan.className = 'font-bold text-gray-800';
              nameSpan.textContent = prize.prizeName;
              
              // å¥–å“ä»·å€¼
              const valueSpan = document.createElement('div');
              valueSpan.className = 'text-sm text-gray-500';
              valueSpan.textContent = `ä»·å€¼: ${prize.prizeValue || 'æœªçŸ¥'}`;
              
              // ä¸­å¥–æ—¶é—´
              const timeSpan = document.createElement('div');
              timeSpan.className = 'text-xs text-gray-400';
              timeSpan.textContent = `ä¸­å¥–æ—¶é—´: ${formatDate(prize.timestamp)}`;
              
              infoDiv.appendChild(nameSpan);
              infoDiv.appendChild(valueSpan);
              infoDiv.appendChild(timeSpan);
              
              prizeItem.appendChild(iconDiv);
              prizeItem.appendChild(infoDiv);
              
              prizesList.appendChild(prizeItem);
            });
          }
        }
        
        // æ˜¾ç¤ºå¼¹çª—
        prizesModal.style.display = 'flex';
      } catch (error) {
        console.error('æ˜¾ç¤ºå¥–å“æ—¶å‡ºé”™:', error);
        // å¦‚æœå‡ºé”™ï¼Œæ˜¾ç¤ºé”™è¯¯æç¤º
        alert('æŸ¥çœ‹å¥–å“å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
      }
    }
    <div class="bg-white rounded-xl w-4/5 max-w-sm overflow-hidden transform transition-all duration-300 scale-100">
      <div class="bg-gradient-to-r from-primary to-secondary p-4 text-center">
        <h3 class="text-white text-xl font-bold">éªŒè¯èº«ä»½</h3>
      </div>
      <div class="p-6">
        <div class="mb-4">
          <label for="phone-input" class="block text-gray-700 mb-2">è¯·è¾“å…¥æ‰‹æœºå·ç </label>
          <input 
            type="tel" 
            id="phone-input" 
            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-gray-800"
            placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·ç "
            maxlength="11"
          >
          <div id="phone-error" class="text-red-500 text-sm mt-1 hidden">è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·ç </div>
          <div id="already-participated-error" class="text-red-500 text-sm mt-1 hidden">è¯¥å·ç å·²å‚ä¸è¿‡æŠ½å¥–</div>
        </div>
        <button id="submit-phone" class="bg-primary text-white py-3 px-8 rounded-full font-bold w-full shadow-lg hover:bg-opacity-90 transition-all">
          ç¡®å®š
        </button>
        <button id="cancel-phone" class="mt-3 w-full py-3 text-gray-600 font-medium">
          å–æ¶ˆ
        </button>
      </div>
    </div>
  </div>

  <!-- å¼¹å‡ºå±‚ -->
  <div id="result-modal" class="fixed inset-0 bg-black/50 z-50 items-center justify-center hidden">
    <div class="bg-white rounded-xl w-4/5 max-w-sm overflow-hidden transform transition-all duration-300 scale-100">
      <div class="bg-gradient-to-r from-primary to-secondary p-4 text-center">
        <h3 class="text-white text-xl font-bold">æ­å–œä¸­å¥–</h3>
      </div>
      <div class="p-6 text-center">
        <!-- ä¸­å¥–å¥–å“å±•ç¤º -->
        <div id="result-prize" class="mb-6 p-4 bg-gray-50 rounded-xl inline-block">
          <div id="result-icon" class="text-5xl mb-3 text-primary">
            <i class="fa fa-gift"></i>
          </div>
          <div id="result-text" class="text-lg font-bold text-gray-800">å¥–å“åç§°</div>
        </div>
        
        <!-- å¥–å“è¯´æ˜ -->
        <div id="prize-description" class="text-sm text-gray-600 mb-6"></div>
        
        <!-- å¥–å“ä»·å€¼æ˜¾ç¤º -->
        <div id="prize-value" class="text-sm text-green-600 font-medium mb-6"></div>
        
        <button id="close-modal" class="bg-primary text-white py-3 px-8 rounded-full font-bold w-full shadow-lg hover:bg-opacity-90 transition-all">
          ç¡®å®š
        </button>
      </div>
    </div>
  </div>

  <script>
    // å¥–å“é…ç½® - ä¼˜åŒ–ç‰ˆ
    const prizes = [
      { id: 1, name: 'Apple Watch Series 9', icon: 'fa-clock-o', color: 'text-white' },
      { id: 2, name: 'Dyson V15 æ— çº¿å¸å°˜å™¨', icon: 'fa-broom', color: 'text-gray-800' },
      { id: 3, name: 'Nintendo Switch OLED', icon: 'fa-gamepad', color: 'text-secondary' },
      { id: 4, name: 'å°ç±³ç©ºæ°”å‡€åŒ–å™¨4 Pro', icon: 'fa-leaf', color: 'text-primary' },
      { id: 5, name: 'æ»¡2000å‡150å…ƒä¼˜æƒ åˆ¸', icon: 'fa-ticket-alt', color: 'text-primary' },
      { id: 6, name: 'æ»¡1000å‡80å…ƒä¼˜æƒ åˆ¸', icon: 'fa-ticket-alt', color: 'text-primary' },
      { id: 7, name: 'æ»¡500å‡50å…ƒä¼˜æƒ åˆ¸', icon: 'fa-ticket-alt', color: 'text-primary' },
      { id: 8, name: 'å‚ä¸å¥–-10å…ƒæ— é—¨æ§›åˆ¸', icon: 'fa-gift', color: 'text-gray-500' }
    ];

    // æ¦‚ç‡é…ç½®ï¼ˆç›¸å¯¹æƒé‡ï¼Œæ€»å’Œä¸º1000ï¼‰
    // é«˜ä»·å€¼å¥–å“æ¦‚ç‡è¾ƒä½ï¼Œä¸­ä½ä»·å€¼å¥–å“æ¦‚ç‡é€‚ä¸­ï¼Œå‚ä¸å¥–ä¿è¯ç”¨æˆ·æœ‰æ‰€æ”¶è·
    const probabilities = [
      1,   // Apple Watch Series 9 (0.1%)
      2,   // Dyson V15 æ— çº¿å¸å°˜å™¨ (0.2%)
      5,   // Nintendo Switch OLED (0.5%)
      20,  // å°ç±³ç©ºæ°”å‡€åŒ–å™¨4 Pro (2%)
      50,  // æ»¡2000å‡150å…ƒä¼˜æƒ åˆ¸ (5%)
      120, // æ»¡1000å‡80å…ƒä¼˜æƒ åˆ¸ (12%)
      200, // æ»¡500å‡50å…ƒä¼˜æƒ åˆ¸ (20%)
      602  // å‚ä¸å¥–-10å…ƒæ— é—¨æ§›åˆ¸ (60.2%)
    ];

    // åŠ¨ç”»é¡ºåºï¼ˆæ¨¡æ‹Ÿè½¬ç›˜æ—‹è½¬ï¼‰
    const animationOrder = [1, 2, 3, 6, 8, 7, 4]; // ä¿®å¤äº†é”™è¯¯çš„IDå€¼
    
    // å‰©ä½™æŠ½å¥–æ¬¡æ•°
    let drawCount = 1;
    let isDrawing = false;

    // DOMå…ƒç´ 
    const drawBtn = document.getElementById('draw-btn');
    const resultModal = document.getElementById('result-modal');
    const resultIcon = document.getElementById('result-icon');
    const resultText = document.getElementById('result-text');
    const closeModal = document.getElementById('close-modal');
    const phoneModal = document.getElementById('phone-modal');
    const phoneInput = document.getElementById('phone-input');
    const phoneError = document.getElementById('phone-error');
    const submitPhone = document.getElementById('submit-phone');
    const cancelPhone = document.getElementById('cancel-phone');
    const alreadyDrawn = document.getElementById('already-drawn');
    
    // å½“å‰ç”¨æˆ·çš„ç”µè¯å·ç 
    let currentPhoneNumber = '';
    
    // å·²æŠ½å¥–ç”µè¯å·ç å­˜å‚¨é”®å
    const DRAWN_PHONES_KEY = 'drawn_phone_numbers';
    
    // æ£€æŸ¥ç”µè¯å·ç æ ¼å¼æ˜¯å¦æ­£ç¡®
    function isValidPhone(phone) {
      const phoneRegex = /^1[3-9]\d{9}$/;
      return phoneRegex.test(phone);
    }
    
    // æ£€æŸ¥ç”µè¯å·ç æ˜¯å¦å·²ç»æŠ½è¿‡å¥–
    function hasDrawn(phone) {
      const drawnPhones = JSON.parse(localStorage.getItem(DRAWN_PHONES_KEY) || '[]');
      return drawnPhones.includes(phone);
    }
    
    // è®°å½•ç”µè¯å·ç å·²æŠ½å¥–
    function recordPhoneDraw(phone) {
      const drawnPhones = JSON.parse(localStorage.getItem(DRAWN_PHONES_KEY) || '[]');
      drawnPhones.push(phone);
      localStorage.setItem(DRAWN_PHONES_KEY, JSON.stringify(drawnPhones));
    }
    
    // æ‰“å¼€ç”µè¯å·ç è¾“å…¥å¼¹çª—
    function openPhoneModal() {
      phoneError.classList.add('hidden');
      document.getElementById('already-participated-error').classList.add('hidden');
      phoneInput.value = '';
      phoneModal.style.display = 'flex';
      
      // æ·»åŠ å¼¹å‡ºåŠ¨ç”»
      const modalContent = phoneModal.querySelector('div');
      modalContent.classList.remove('scale-100');
      modalContent.classList.add('scale-90');
      setTimeout(() => {
        modalContent.classList.remove('scale-90');
        modalContent.classList.add('scale-100');
      }, 10);
    }
    
    // å…³é—­ç”µè¯å·ç è¾“å…¥å¼¹çª—
    function closePhoneModal() {
      phoneModal.style.display = 'none';
    }
    
    // åˆå§‹åŒ–æ£€æŸ¥
    function initCheck() {
      // è¿™é‡Œå¯ä»¥æ·»åŠ ä»localStorageæˆ–å…¶ä»–å­˜å‚¨ä¸­æ¢å¤å½“å‰ç”¨æˆ·ä¿¡æ¯çš„é€»è¾‘
      // ä¾‹å¦‚æ£€æŸ¥æ˜¯å¦æœ‰è®°ä½çš„ç”µè¯å·ç ç­‰
    }
    
    // æ˜¾ç¤ºç”¨æˆ·å¥–å“
    function showMyPrizes() {
          try {
            // è·å–å¼¹çª—å…ƒç´ 
            let prizesModal = document.getElementById('prizes-modal');
            
            // ç¡®ä¿å¼¹çª—å­˜åœ¨
            if (!prizesModal) {
              // åˆ›å»ºå¼¹çª—
              const modalHTML = `
                <div id="prizes-modal" class="fixed inset-0 bg-black/50 z-50 items-center justify-center hidden">
                  <div class="bg-white rounded-xl w-4/5 max-w-sm max-h-[80vh] overflow-hidden">
                    <div class="bg-gradient-to-r from-primary to-secondary p-4 text-center">
                      <h3 class="text-white text-xl font-bold">æˆ‘çš„å¥–å“</h3>
                    </div>
                    <div class="p-6">
                      <div id="prizes-list" class="space-y-4 max-h-[60vh] overflow-y-auto">
                        <div id="no-prizes" class="text-center text-gray-500 py-8">
                          <i class="fa fa-trophy text-gray-300 text-3xl mb-2"></i>
                          <p>æš‚æ— ä¸­å¥–è®°å½•</p>
                        </div>
                      </div>
                      <div class="px-6 pb-6">
                        <button id="close-prizes" class="bg-gray-200 text-gray-700 py-3 px-8 rounded-full font-bold w-full hover:bg-gray-300 transition-all">
                          å…³é—­
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              `;
              document.body.insertAdjacentHTML('beforeend', modalHTML);
              prizesModal = document.getElementById('prizes-modal');
            }
            
            const prizesList = document.getElementById('prizes-list');
            
            if (!prizesList) {
              console.error('æ‰¾ä¸åˆ°å¿…è¦çš„DOMå…ƒç´ ');
              alert('ç³»ç»Ÿé”™è¯¯ï¼Œè¯·ç¨åå†è¯•');
              return;
            }
            
            // æ¸…ç©ºåˆ—è¡¨
            prizesList.innerHTML = '';
            
            // è·å–å½“å‰ç”¨æˆ·ç”µè¯
            const currentPhone = currentPhoneNumber || localStorage.getItem('lastPhoneNumber');
            console.log('å½“å‰ç”¨æˆ·ç”µè¯:', currentPhone);
            
            if (!currentPhone) {
              // å¦‚æœæ²¡æœ‰ç”µè¯å·ç ï¼Œæ˜¾ç¤ºæ— ä¸­å¥–è®°å½•
              prizesList.innerHTML = `
                <div id="no-prizes" class="text-center text-gray-500 py-8">
                  <i class="fa fa-trophy text-gray-300 text-3xl mb-2"></i>
                  <p>æš‚æ— ä¸­å¥–è®°å½•</p>
                </div>
              `;
            } else {
              // è·å–æ‰€æœ‰ä¸­å¥–è®°å½•
              const allPrizes = JSON.parse(localStorage.getItem('userPrizes') || '[]');
              console.log('æ‰€æœ‰ä¸­å¥–è®°å½•:', allPrizes);
              
              // ç­›é€‰å½“å‰ç”¨æˆ·çš„ä¸­å¥–è®°å½•
              const userPrizes = allPrizes.filter(prize => prize.phone === currentPhone);
              console.log('ç”¨æˆ·ä¸­å¥–è®°å½•:', userPrizes);
              
              if (userPrizes.length === 0) {
                // æ— ä¸­å¥–è®°å½•
                prizesList.innerHTML = `
                  <div id="no-prizes" class="text-center text-gray-500 py-8">
                    <i class="fa fa-trophy text-gray-300 text-3xl mb-2"></i>
                    <p>æš‚æ— ä¸­å¥–è®°å½•</p>
                  </div>
                `;
              } else {
                // æœ‰ä¸­å¥–è®°å½•ï¼Œç”Ÿæˆåˆ—è¡¨
                // æŒ‰æ—¶é—´å€’åºæ’åº
                userPrizes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                userPrizes.forEach((prize) => {
                  const prizeItem = document.createElement('div');
                  prizeItem.className = 'bg-gradient-to-r from-primary/10 to-secondary/10 rounded-lg p-4 flex items-center';
                  
                  // å¥–å“å›¾æ ‡
                  const iconDiv = document.createElement('div');
                  iconDiv.className = 'bg-white rounded-full w-12 h-12 flex items-center justify-center mr-4 shadow-md';
                  iconDiv.innerHTML = `<i class="fa ${prize.prizeIcon || 'fa-gift'} text-primary text-xl"></i>`;
                  
                  // å¥–å“ä¿¡æ¯
                  const infoDiv = document.createElement('div');
                  infoDiv.className = 'flex-1';
                  
                  const nameSpan = document.createElement('div');
                  nameSpan.className = 'font-bold text-gray-800';
                  nameSpan.textContent = prize.prizeName;
                  
                  const valueSpan = document.createElement('div');
                  valueSpan.className = 'text-sm text-gray-500';
                  valueSpan.textContent = `ä»·å€¼: ${prize.prizeValue || 'æœªçŸ¥'}`;
                  
                  // ä¸­å¥–æ—¶é—´
                  const timeSpan = document.createElement('div');
                  timeSpan.className = 'text-xs text-gray-400';
                  timeSpan.textContent = `ä¸­å¥–æ—¶é—´: ${formatDate(prize.timestamp)}`;
                  
                  infoDiv.appendChild(nameSpan);
                  infoDiv.appendChild(valueSpan);
                  infoDiv.appendChild(timeSpan);
                  
                  prizeItem.appendChild(iconDiv);
                  prizeItem.appendChild(infoDiv);
                  
                  prizesList.appendChild(prizeItem);
                });
              }
            }
            
            // æ˜¾ç¤ºå¼¹çª—
            prizesModal.style.display = 'flex';
            
            // ç»‘å®šå…³é—­äº‹ä»¶
            const closeBtn = document.getElementById('close-prizes');
            if (closeBtn) {
              // ç§»é™¤æ‰€æœ‰ç°æœ‰çš„äº‹ä»¶ç›‘å¬å™¨
              const newCloseBtn = closeBtn.cloneNode(true);
              closeBtn.parentNode.replaceChild(newCloseBtn, closeBtn);
              
              // ç»‘å®šæ–°çš„ç‚¹å‡»äº‹ä»¶
              newCloseBtn.onclick = function() {
                console.log('å…³é—­æŒ‰é’®è¢«ç‚¹å‡»');
                const modal = document.getElementById('prizes-modal');
                if (modal) {
                  modal.style.display = 'none';
                  console.log('å¼¹çª—å·²å…³é—­');
                }
              };
            }
            
            // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
            const modal = document.getElementById('prizes-modal');
            modal.onclick = function(e) {
              if (e.target === modal) {
                modal.style.display = 'none';
              }
            };
          } catch (error) {
            console.error('æ˜¾ç¤ºå¥–å“æ—¶å‡ºé”™:', error);
            alert('æŸ¥çœ‹å¥–å“å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
          }
        }
        
        // ä¸º"æˆ‘çš„å¥–å“"æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶
        function bindMyPrizesButton() {
          const myPrizesBtn = document.getElementById('my-prizes');
          if (myPrizesBtn) {
            // ä½¿ç”¨æ›´ç®€å•å¯é çš„æ–¹å¼ç»‘å®šç‚¹å‡»äº‹ä»¶
            myPrizesBtn.onclick = function() {
              console.log('æˆ‘çš„å¥–å“æŒ‰é’®è¢«ç‚¹å‡»');
              showMyPrizes();
            };
            console.log('æˆ‘çš„å¥–å“æŒ‰é’®äº‹ä»¶ç»‘å®šæˆåŠŸ');
          } else {
            console.error('æ‰¾ä¸åˆ°æˆ‘çš„å¥–å“æŒ‰é’®');
          }
        }
        
        // ç«‹å³ç»‘å®š
        bindMyPrizesButton();
        
        // å¤‡ç”¨çš„å»¶æ—¶ç»‘å®š
        setTimeout(bindMyPrizesButton, 500);
    
    // ç®¡ç†å‘˜åŠŸèƒ½ - éªŒè¯ç éªŒè¯ç›¸å…³
    const adminEntry = document.getElementById('admin-entry');
      // å·²å‚ä¸æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    adminEntry.addEventListener('click', () => {
        // åŠ¨æ€åˆ›å»ºå¹¶æ˜¾ç¤ºéªŒè¯ç å¼¹çª—
        createAndShowVerifyModal();
      });
    
    // åˆ›å»ºå¹¶æ˜¾ç¤ºéªŒè¯ç å¼¹çª—
    function createAndShowVerifyModal() {
      // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨å¼¹çª—
      let verifyModal = document.getElementById('verify-modal');
      if (!verifyModal) {
        // åˆ›å»ºéªŒè¯ç å¼¹çª—HTML
        const modalHTML = `
          <div id="verify-modal" class="fixed inset-0 bg-black/50 z-50 items-center justify-center">
            <div class="bg-white rounded-xl w-4/5 max-w-sm overflow-hidden transform transition-all duration-300 scale-100">
              <div class="bg-gradient-to-r from-primary to-secondary p-4 text-center">
                <h3 class="text-white text-xl font-bold">ç®¡ç†å‘˜éªŒè¯</h3>
              </div>
              <div class="p-6">
                <div class="mb-4">
                  <label for="verify-code" class="block text-gray-700 mb-2">è¯·è¾“å…¥éªŒè¯ç </label>
                  <input 
                    type="text" 
                    id="verify-code" 
                    class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary text-gray-800" 
                    placeholder="è¯·è¾“å…¥éªŒè¯ç "
                  >
                  <div id="verify-error" class="text-red-500 text-sm mt-1 hidden">éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
                </div>
                <button id="submit-verify" class="bg-primary text-white py-3 px-8 rounded-full font-bold w-full shadow-lg hover:bg-opacity-90 transition-all">
                  éªŒè¯
                </button>
                <button id="cancel-verify" class="mt-3 w-full py-3 text-gray-600 font-medium">
                  å–æ¶ˆ
                </button>
              </div>
            </div>
          </div>
        `;
        
        // æ·»åŠ åˆ°body
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        verifyModal = document.getElementById('verify-modal');
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        const verifyCodeInput = document.getElementById('verify-code');
        const verifyError = document.getElementById('verify-error');
        const submitVerify = document.getElementById('submit-verify');
        const cancelVerify = document.getElementById('cancel-verify');
        
        // å›ºå®šéªŒè¯ç ï¼šdms
        const CORRECT_VERIFY_CODE = 'dms';
        
        // æäº¤éªŒè¯ç 
        submitVerify.addEventListener('click', () => {
          const code = verifyCodeInput.value.trim().toLowerCase();
          
          if (code === CORRECT_VERIFY_CODE) {
            // ç§»é™¤éªŒè¯ç å¼¹çª—
            verifyModal.remove();
            // æ˜¾ç¤ºå‚ä¸è€…æ˜ç»†
            createAndShowParticipantsModal();
          } else {
            verifyError.classList.remove('hidden');
          }
        });
        
        // å–æ¶ˆéªŒè¯ç 
        cancelVerify.addEventListener('click', () => {
          verifyModal.remove();
        });
        
        // éªŒè¯ç è¾“å…¥æ¡†æŒ‰å›è½¦æ—¶æäº¤
        verifyCodeInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            submitVerify.click();
          }
        });
        
        // æ·»åŠ å¼¹å‡ºåŠ¨ç”»
        const modalContent = verifyModal.querySelector('div');
        modalContent.classList.remove('scale-100');
        modalContent.classList.add('scale-90');
        setTimeout(() => {
          modalContent.classList.remove('scale-90');
          modalContent.classList.add('scale-100');
        }, 10);
      }
    }
    
    // åˆ›å»ºå¹¶æ˜¾ç¤ºå‚ä¸è€…æ˜ç»†å¼¹çª—
    function createAndShowParticipantsModal() {
      // åˆ›å»ºå‚ä¸è€…æ˜ç»†å¼¹çª—HTML
      const modalHTML = `
        <div id="participants-modal" class="fixed inset-0 bg-black/50 z-50 items-center justify-center">
          <div class="bg-white rounded-xl w-11/12 max-w-2xl max-h-[80vh] overflow-hidden transform transition-all duration-300 scale-100">
            <div class="bg-gradient-to-r from-primary to-secondary p-4 flex justify-between items-center">
              <h3 class="text-white text-xl font-bold">å‚ä¸è€…æ˜ç»†</h3>
              <button id="close-participants" class="text-white">
                <i class="fa fa-times text-xl"></i>
              </button>
            </div>
            <div class="p-6">
              <div class="mb-4">
                <h4 class="text-gray-700 font-medium mb-2">å‚ä¸æŠ½å¥–çš„ç”µè¯å·ç ï¼š</h4>
                <div id="participants-list" class="bg-gray-50 rounded-lg p-4 max-h-[40vh] overflow-y-auto">
                  <!-- å‚ä¸è€…åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                  <div class="text-gray-400 text-center py-8">æš‚æ— å‚ä¸è€…æ•°æ®</div>
                </div>
              </div>
              <button id="export-excel" class="bg-secondary text-white py-3 px-8 rounded-full font-bold w-full shadow-lg hover:bg-opacity-90 transition-all flex items-center justify-center">
                <i class="fa fa-download mr-2"></i> å¯¼å‡ºExcel
              </button>
            </div>
          </div>
        </div>
      `;
      
      // æ·»åŠ åˆ°body
      document.body.insertAdjacentHTML('beforeend', modalHTML);
      const participantsModal = document.getElementById('participants-modal');
      const participantsList = document.getElementById('participants-list');
      const closeParticipants = document.getElementById('close-participants');
      const exportExcelBtn = document.getElementById('export-excel');
      
      // åŠ è½½å‚ä¸è€…åˆ—è¡¨
      loadParticipantsList();
      
      // å…³é—­å‚ä¸è€…æ˜ç»†å¼¹çª—
      closeParticipants.addEventListener('click', () => {
        participantsModal.remove();
      });
      
      // å¯¼å‡ºExcelåŠŸèƒ½
      exportExcelBtn.addEventListener('click', () => {
        exportParticipantsToExcel();
      });
      
      // æ·»åŠ å¼¹å‡ºåŠ¨ç”»
      const modalContent = participantsModal.querySelector('div');
      modalContent.classList.remove('scale-100');
      modalContent.classList.add('scale-90');
      setTimeout(() => {
        modalContent.classList.remove('scale-90');
        modalContent.classList.add('scale-100');
      }, 10);
    }
    
    // åŠ è½½å‚ä¸è€…åˆ—è¡¨
    function loadParticipantsList() {
      const drawnPhones = JSON.parse(localStorage.getItem(DRAWN_PHONES_KEY) || '[]');
      const participantsList = document.getElementById('participants-list');
      
      if (drawnPhones.length === 0) {
        participantsList.innerHTML = '<div class="text-gray-400 text-center py-8">æš‚æ— å‚ä¸è€…æ•°æ®</div>';
        return;
      }
      
      // ç”Ÿæˆå‚ä¸è€…åˆ—è¡¨HTML
      let html = '<div class="space-y-2">';
      drawnPhones.forEach((phone, index) => {
        html += `
          <div class="flex justify-between items-center p-2 border-b border-gray-100">
            <span class="text-gray-700">${phone}</span>
            <span class="text-gray-500 text-sm">ç¬¬${index + 1}ä½</span>
          </div>
        `;
      });
      html += '</div>';
      
      participantsList.innerHTML = html;
    }
    
    // å¯¼å‡ºå‚ä¸è€…æ•°æ®åˆ°Excel
    function exportParticipantsToExcel() {
      const drawnPhones = JSON.parse(localStorage.getItem(DRAWN_PHONES_KEY) || '[]');
      
      if (drawnPhones.length === 0) {
        alert('æš‚æ— æ•°æ®å¯å¯¼å‡º');
        return;
      }
      
      // åˆ›å»ºCSVæ ¼å¼æ•°æ®ï¼ˆå¯è¢«Excelæ‰“å¼€ï¼‰
      let csvContent = 'åºå·,ç”µè¯å·ç \n';
      drawnPhones.forEach((phone, index) => {
        csvContent += `${index + 1},${phone}\n`;
      });
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const blob = new Blob([`\ufeff${csvContent}`], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `å‚ä¸è€…æ˜ç»†_${new Date().toLocaleDateString('zh-CN').replace(/\//g, '-')}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // æ ¹æ®æ¦‚ç‡éšæœºé€‰æ‹©å¥–å“ - ä¼˜åŒ–ç‰ˆ
    function selectPrize() {
      // ç›´æ¥ä½¿ç”¨é…ç½®çš„æ¦‚ç‡æƒé‡
      // è®¡ç®—æ€»æƒé‡
      const total = probabilities.reduce((a, b) => a + b, 0);
      let random = Math.random() * total;
      let sum = 0;
      
      // æ ¹æ®éšæœºæ•°é€‰æ‹©å¥–å“
      for (let i = 0; i < probabilities.length; i++) {
        sum += probabilities[i];
        if (random < sum) {
          const selectedPrize = prizes[i];
          console.log(`æŠ½å¥–ç»“æœ: ${selectedPrize.name} (æ¦‚ç‡æƒé‡: ${probabilities[i]}/${total})`);
          return selectedPrize;
        }
      }
      
      // é»˜è®¤è¿”å›å‚ä¸å¥–ï¼ˆç†è®ºä¸Šä¸åº”è¯¥èµ°åˆ°è¿™é‡Œï¼‰
      return prizes[7];
    }

    // æŠ½å¥–åŠ¨ç”»
    function startDrawAnimation(targetId) {
      return new Promise((resolve) => {
        let currentIndex = 0;
        let speed = 100;
        let steps = 0;
        const totalSteps = 50; // æ€»æ­¥æ•°
        const targetPos = prizes.findIndex(p => p.id === targetId);
        
        const animate = () => {
          steps++;
          
          // æ¸…é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.prize-item').forEach(item => {
              item.classList.remove('active');
            });
          
          // é«˜äº®å½“å‰å¥–å“
          const currentPos = animationOrder[currentIndex % animationOrder.length];
          if (currentPos !== 5) { // è·³è¿‡ä¸­å¿ƒæŒ‰é’®
            document.getElementById(`prize-${currentPos}`).classList.add('active');
          }
          
          // åŠ é€Ÿé˜¶æ®µ
          if (steps < 10) {
            speed -= 5;
          }
          // åŒ€é€Ÿé˜¶æ®µ
          else if (steps < totalSteps - 10) {
            speed = 50;
          }
          // å‡é€Ÿé˜¶æ®µ
          else {
            speed += 10;
          }
          
          // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡ä½ç½®
          if (steps >= totalSteps && currentPos === targetId) {
            resolve();
            return;
          }
          // æ·»åŠ é¢å¤–çš„å®‰å…¨é€€å‡ºæ¡ä»¶ï¼Œé¿å…æ— é™å¾ªç¯
          if (steps > totalSteps * 2) {
            console.warn('æŠ½å¥–åŠ¨ç”»è¶…æ—¶ï¼Œå¼ºåˆ¶ç»“æŸ');
            resolve();
            return;
          }
          
          currentIndex++;
          setTimeout(animate, speed);
        };
        
        animate();
      });
    }

    // å¥–å“è¯¦æƒ…é…ç½® - ä¼˜åŒ–ç‰ˆ
    const prizeDetails = {
      1: { description: 'æœ€æ–°æ¬¾æ™ºèƒ½æ‰‹è¡¨ï¼Œå¥åº·ç›‘æµ‹+è¿åŠ¨è¿½è¸ªï¼Œå…¨å¤©å€™é™ªä¼´', value: 'ä»·å€¼ Â¥3199' },
      2: { description: 'å¼ºåŠ²å¸åŠ›ï¼Œæ™ºèƒ½æ¸…æ´ï¼Œè®©æ‚¨çš„å®¶ç„•ç„¶ä¸€æ–°', value: 'ä»·å€¼ Â¥4990' },
      3: { description: '7è‹±å¯¸OLEDå±å¹•ï¼Œç•…ç©çƒ­é—¨æ¸¸æˆï¼Œéšæ—¶éšåœ°å¨±ä¹', value: 'ä»·å€¼ Â¥2599' },
      4: { description: 'é«˜æ•ˆå‡€åŒ–ç©ºæ°”ï¼Œå»é™¤æœ‰å®³ç‰©è´¨ï¼Œå®ˆæŠ¤å®¶äººå¥åº·', value: 'ä»·å€¼ Â¥1299' },
      5: { description: 'å…¨åœºé€šç”¨ï¼Œæ— å“ç±»é™åˆ¶ï¼Œæœ‰æ•ˆæœŸ60å¤©', value: 'ä»·å€¼ Â¥150' },
      6: { description: 'å…¨åœºé€šç”¨ï¼Œæ— å“ç±»é™åˆ¶ï¼Œæœ‰æ•ˆæœŸ60å¤©', value: 'ä»·å€¼ Â¥80' },
      7: { description: 'å…¨åœºé€šç”¨ï¼Œæ— å“ç±»é™åˆ¶ï¼Œæœ‰æ•ˆæœŸ60å¤©', value: 'ä»·å€¼ Â¥50' },
      8: { description: 'æ„Ÿè°¢å‚ä¸ï¼æ— é—¨æ§›ä½¿ç”¨ï¼Œå…¨åœºé€šç”¨ï¼Œæœ‰æ•ˆæœŸ30å¤©', value: 'ä»·å€¼ Â¥10' }
    };

    // æ˜¾ç¤ºç»“æœ
    function showResult(prize) {
      // è·å–DOMå…ƒç´ 
      const resultIcon = document.getElementById('result-icon');
      const resultPrize = document.getElementById('result-prize');
      const modalTitle = document.querySelector('#result-modal h3');
      
      // è®¾ç½®å›¾æ ‡
      resultIcon.innerHTML = `<i class="fa ${prize.icon}"></i>`;
      resultIcon.className = `${prize.color} text-5xl mb-3`;
      
      // è®¾ç½®å¥–å“åç§°
      resultText.textContent = prize.name;
      
      // è®¾ç½®å¥–å“æè¿°å’Œä»·å€¼
      const details = prizeDetails[prize.id];
      document.getElementById('prize-description').textContent = details.description;
      document.getElementById('prize-value').textContent = details.value;
      
      // é‡ç½®æ ·å¼
      modalTitle.textContent = 'æ­å–œä¸­å¥–';
      resultPrize.className = 'mb-6 p-4 rounded-xl inline-block';
      resultIcon.className = `${prize.color} text-5xl mb-3`;
      
      // æ·»åŠ é€šç”¨çš„æ·¡å…¥æ•ˆæœ
      resultPrize.style.opacity = '0';
      setTimeout(() => {
        resultPrize.style.transition = 'opacity 0.5s ease-in-out, transform 0.5s ease-in-out';
        resultPrize.style.opacity = '1';
      }, 100);
      
      // æ ¹æ®å¥–å“ç­‰çº§è®¾ç½®ä¸åŒæ ·å¼å’Œç‰¹æ•ˆ
      if (prize.id <= 3) { // é«˜ä»·å€¼å¥–å“
        // é«˜ä»·å€¼å¥–å“ç‰¹æ®Šæ ·å¼
        resultPrize.classList.add('bg-gradient-to-r', 'from-amber-50', 'to-yellow-100');
        resultPrize.classList.add('border-2', 'border-yellow-400', 'shadow-lg');
        modalTitle.textContent = 'ğŸ‰ æ­å–œè·å¾—å¤§å¥– ğŸ‰';
        modalTitle.classList.add('text-yellow-600');
        
        // æ·»åŠ é—ªçƒåŠ¨ç”»æ•ˆæœ
        resultPrize.classList.add('animate-pulse');
        setTimeout(() => {
          resultPrize.classList.remove('animate-pulse');
          // æ·»åŠ ç¼©æ”¾åŠ¨ç”»
          resultPrize.style.transform = 'scale(1.05)';
          setTimeout(() => {
            resultPrize.style.transform = 'scale(1)';
          }, 300);
        }, 2000);
        
      } else if (prize.id <= 4) { // ä¸­ä»·å€¼å¥–å“
        resultPrize.classList.add('bg-gradient-to-r', 'from-gray-50', 'to-gray-100');
        resultPrize.classList.add('border-2', 'border-gray-300');
        modalTitle.textContent = 'ğŸŠ æ­å–œä¸­å¥– ğŸŠ';
        
      } else if (prize.id <= 7) { // ä¼˜æƒ åˆ¸
        resultPrize.classList.add('bg-gradient-to-r', 'from-primary/15', 'to-secondary/15');
        resultPrize.classList.add('shadow-sm');
        
        // ä¼˜æƒ åˆ¸ç‰¹æ®ŠåŠ¨ç”»
        setTimeout(() => {
          resultPrize.style.transform = 'scale(1.02) rotate(1deg)';
          setTimeout(() => {
            resultPrize.style.transform = 'scale(1) rotate(0deg)';
          }, 200);
        }, 300);
        
      } else { // å‚ä¸å¥–
        modalTitle.textContent = 'ğŸ æ­å–œè·å¾—å‚ä¸å¥– ğŸ';
        resultPrize.classList.add('bg-gray-50', 'border', 'border-gray-200');
      }
      
      // æ˜¾ç¤ºå¼¹çª—å¹¶æ·»åŠ å¼¹å‡ºåŠ¨ç”»
      resultModal.style.display = 'flex';
      const modalContent = resultModal.querySelector('div');
      modalContent.classList.remove('scale-100');
      modalContent.classList.add('scale-90');
      setTimeout(() => {
        modalContent.classList.remove('scale-90');
        modalContent.classList.add('scale-100');
      }, 10);
    }

    // æŠ½å¥–æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    drawBtn.addEventListener('click', () => {
      if (isDrawing) return;
      
      // å¦‚æœå·²ç»éªŒè¯è¿‡èº«ä»½å¹¶ä¸”è¿˜èƒ½æŠ½å¥–
      if (currentPhoneNumber && drawCount > 0) {
        startDrawProcess();
      } else {
        // å¦åˆ™æ˜¾ç¤ºç”µè¯å·ç è¾“å…¥å¼¹çª—
        openPhoneModal();
      }
    });
    
    // ä¿å­˜æœ€åä½¿ç”¨çš„ç”µè¯å·ç 
    function saveLastPhoneNumber(phone) {
      localStorage.setItem('lastPhoneNumber', phone);
    }
    
    // äº‹ä»¶ç›‘å¬å™¨å·²åœ¨showMyPrizeså‡½æ•°å†…éƒ¨å¤„ç†ï¼Œé¿å…é‡å¤ç»‘å®š
    
    // æäº¤ç”µè¯å·ç 
    submitPhone.addEventListener('click', () => {
      const phone = phoneInput.value.trim();
      
      // éªŒè¯ç”µè¯å·ç æ ¼å¼
      if (!isValidPhone(phone)) {
        phoneError.classList.remove('hidden');
        return;
      }
      
      // æ£€æŸ¥æ˜¯å¦å·²ç»æŠ½è¿‡å¥–
      if (hasDrawn(phone)) {
        // æ˜¾ç¤ºå·²å‚ä¸é”™è¯¯æç¤º
        phoneError.classList.add('hidden');
        document.getElementById('already-participated-error').classList.remove('hidden');
        return;
      }
      
      // éªŒè¯é€šè¿‡ï¼Œè®°å½•ç”µè¯å·ç å¹¶ä¿å­˜åˆ°localStorage
      currentPhoneNumber = phone;
      saveLastPhoneNumber(phone);
      closePhoneModal();
      
      // å¼€å§‹æŠ½å¥–
      startDrawProcess();
    });
    
    // å–æ¶ˆè¾“å…¥ç”µè¯å·ç 
    cancelPhone.addEventListener('click', () => {
      closePhoneModal();
    });
    
    // ç”µè¯å·ç è¾“å…¥äº‹ä»¶å¤„ç†
    phoneInput.addEventListener('input', () => {
      // åªå…è®¸è¾“å…¥æ•°å­—
      phoneInput.value = phoneInput.value.replace(/\D/g, '');
      // éšè—é”™è¯¯æç¤º
      phoneError.classList.add('hidden');
      document.getElementById('already-participated-error').classList.add('hidden');
    });
    
    // ç”µè¯å·ç è¾“å…¥æ¡†æŒ‰å›è½¦æ—¶æäº¤
    phoneInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        submitPhone.click();
      }
    });
    
    // è®°å½•ç”¨æˆ·ä¸­å¥–ä¿¡æ¯ - ä¼˜åŒ–ç‰ˆ
    function recordUserPrize(phone, prize) {
      // ç°åœ¨æ‰€æœ‰å¥–å“ï¼ˆåŒ…æ‹¬å‚ä¸å¥–ï¼‰éƒ½éœ€è¦è®°å½•
      const userPrizes = JSON.parse(localStorage.getItem('userPrizes') || '[]');
      const timestamp = new Date().toISOString();
      
      // è·å–å¥–å“è¯¦æƒ…ä¸­çš„ä»·å€¼ä¿¡æ¯
      const details = window.prizeDetails ? (window.prizeDetails[prize.id] || {}) : {};
      
      userPrizes.push({
        phone: phone,
        prizeName: prize.name,
        prizeValue: details.value || 'ä»·å€¼æœªçŸ¥',
        prizeIcon: prize.icon,
        timestamp: timestamp,
        prizeId: prize.id // æ·»åŠ å¥–å“IDä¾¿äºåç»­æŸ¥è¯¢
      });
      
      localStorage.setItem('userPrizes', JSON.stringify(userPrizes));
      console.log(`å·²è®°å½•ç”¨æˆ· ${phone} çš„ä¸­å¥–ä¿¡æ¯: ${prize.name}`);
    }
    
    // å¼€å§‹æŠ½å¥–æµç¨‹
    async function startDrawProcess() {
      if (isDrawing || drawCount <= 0) return;
      
      isDrawing = true;
      drawCount--;
      
      // è®°å½•å·²æŠ½å¥–
      recordPhoneDraw(currentPhoneNumber);
      
      // é€‰æ‹©å¥–å“
      const selectedPrize = selectPrize();
      
      // æ‰§è¡ŒåŠ¨ç”»
      await startDrawAnimation(selectedPrize.id);
      
      // è®°å½•ç”¨æˆ·ä¸­å¥–ä¿¡æ¯ï¼ˆå¦‚æœä¸­å¥–ï¼‰
      recordUserPrize(currentPhoneNumber, selectedPrize);
      
      // æ˜¾ç¤ºç»“æœ
      showResult(selectedPrize);
      
      isDrawing = false;
    }

    // å…³é—­å¼¹å‡ºå±‚
    closeModal.addEventListener('click', () => {
      resultModal.style.display = 'none';
      
      // æ¸…é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
      document.querySelectorAll('.prize-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // å¦‚æœæŠ½å¥–æ¬¡æ•°ç”¨å®Œäº†ï¼Œæ˜¾ç¤ºå·²æŠ½å¥–æç¤º
      if (drawCount <= 0) {
        alreadyDrawn.classList.remove('hidden');
      }
    });
    
    // è°ƒè¯•å‡½æ•° - ç¡®ä¿ä»£ç æ­£ç¡®é—­åˆ
    console.log('æŠ½å¥–ç¨‹åºåŠ è½½å®Œæˆ');
  </script>
</body>
</html>